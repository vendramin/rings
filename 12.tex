%\section{Lecture -- Week 12}

\section{The Smith normal form}

We finish the course with an algorithm that allows us to understand the
structure of certain finitely generated modules.  We will discuss the case of
modules over euclidean domains, as in this case the algorithm is constructive. 

Let $R$ be a euclidean domain, 
$M$ be a finitely generated $R$-module and $\{m_1,\dots,m_k\}$ be a set of
generators.  There exists a surjective module homomorphism 
\[
	\varphi\colon R^k\to M, 
	\quad
	(r_1,\dots,r_k)\mapsto \sum_{i=1}^k r_i\cdot m_i,
\]
and hence 
$M\simeq R^k/\ker\varphi$. 
The submodule $\ker\varphi$ of $R^k$ is the \emph{relations module} of $M$. 
Since $R$ is an euclidean domain, $R$ is noetherian. It follows that
$\ker\varphi$ of $R^k$. Let 
$\{e_1,\dots,e_l\}$ be a generating set of $\ker\varphi$. 
The row matrix  
\[
A=\begin{pmatrix}
e_1\\
e_2\\
\vdots\\
e_l
\end{pmatrix}
\]
has size $l\times k$ and 
is the 
\emph{relation matrix} of $M$ with respect to $\{m_1,\dots,m_k\}$ 
and $\{e_1,\dots,e_l\}$. 

Multiplying a relation matrix 
on the left by an invertible matrix, changes the generators of the relation module: 

\begin{claim}
		If $P\in R^{l\times l}$ is invertible, then the rows
		$\{f_1,\dots,f_l\}$ of $PA$ generate $\ker\varphi$. Moreover, $PA$ is
		the relations matrix with respect to $\{m_1,\dots,m_k\}$ and
		$\{f_1,\dots,f_l\}$. 
\end{claim}

%Some properties:
%\begin{enumerate}
%	\item If $P\in R^{l\times l}$ is invertible, then the rows
%		$\{f_1,\dots,f_l\}$ of $PA$ generate $\ker\varphi$. Moreover, $PA$ is
%		the relations matrix with respect to $\{m_1,\dots,m_k\}$ and
%		$\{f_1,\dots,f_l\}$. 
%	\item If $Q\in R^{k\times k}$ is invertible and $Q^{-1}=(q_{ij})$ and for
%		each $j\in\{1,\dots,k\}$ we define $n_j=\sum_{i=1}^k q_{ij}\cdot m_i$,
%		the set $\{n_1,\dots,n_k\}$ generates $M$ and the rows of 
%$AQ$ generate $\ker\varphi$. Moreover, $AQ$ is the relations matrix with respect to $\{n_1\dots,n_k\}$.  
%\end{enumerate}

Let us prove the claim. Assume that $P=(p_{ij})$. Each row of $PA$ belongs to $\ker\varphi$, because
\[
PA\begin{pmatrix}
    m_1\\
    m_2\\
    \vdots\\
    m_k
\end{pmatrix}=0
\Longleftrightarrow 
A\begin{pmatrix}
    m_1\\
    m_2\\
    \vdots\\
    m_k
\end{pmatrix}=0,
\]
as $P$ is invertible. Therefore $f_j\in\ker\varphi$ for all $j\in\{1,\dots,l\}$. 
Since $P$ is invertible, the set $\{f_1,\dots,f_l\}$ generates $\ker\varphi$. Indeed, each 
$e_j$ is a linear combination of the $f_i$'s,  
\[
\begin{pmatrix}
e_1\\
e_2\\
\vdots\\
e_l	
\end{pmatrix}
=P^{-1}\begin{pmatrix}
f_1\\
f_2\\
\vdots\\
f_l
\end{pmatrix}.
\]
In particular, $PA$ is the relations matrix with respect to 
$\{m_1,\dots,m_k\}$ and $\{f_1,\dots,f_l\}$.  

Now multiplying a relation matrix on the right by an invertible matrix, 
changes the original generating set of the module and the relation module: 

\begin{claim}
	Let $Q\in R^{k\times k}$ be invertible and 
    $Q^{-1}=(q_{ij})$. Assume that for each
	$j\in\{1,\dots,k\}$ we define $n_j=\sum_{i=1}^k q_{ji}\cdot m_i$. 
    Let $\psi\colon R^k\to M$, $(r_1,\dots,r_k)\mapsto \sum_{i=1}^k r_i\cdot n_i$.
    Then    
    the set
	$\{n_1,\dots,n_k\}$ generates $M$ and the rows of $AQ$ generate
	$\ker\psi$. Moreover, $AQ$ is the relation matrix with respect to
	$\{n_1\dots,n_k\}$.  
\end{claim}

Now we prove the claim. Since 
\[
\begin{pmatrix}
n_1\\
n_2\\
\vdots\\
n_k	
\end{pmatrix}
=Q^{-1}\begin{pmatrix}
m_1\\
m_2\\
\vdots\\
m_k
\end{pmatrix}.
\]
In particular, the elements 
\begin{align*}
&n_1=\psi(1,0,0,\dots,0),\\
&n_2=\psi(0,1,0,\dots,0),\\
&\quad\vdots\\
&n_k=\psi(0,0,\dots,1) 
\end{align*}
generate $M$. 

We need to prove that the rows of $AQ$ generate $\ker\psi$. 
Since $Q^{-1}$ is invertible, 
\[
\ker\psi=\{vQ:v\in\ker\varphi\}.
\]
In particular, $\{e_1Q,\dots,e_lQ\}$ generate $\ker\psi$, and
the $e_jQ$ are exactly the rows of $AQ$. 

We want to find a way of suitable matrices $P$ and $Q$ 
such that $PAQ$ is a diagonal matrix, so we can 
get a better description of our module $M$. 

\begin{exercise}
\label{xca:submodules}
    Let $R$ be a ring and $M$ and $N$ be $R$-modules. 
    If $S\subseteq M$ and $T\subseteq N$ are submodules, then 
    $(M\oplus N)/(S\oplus T)\simeq M/S\oplus N/T$. 
\end{exercise}

\begin{proposition}
	Let $A$ be the relations matrix of a finitely generated module $M$ with $k$ generators. 
	If there exist invertible matrices $P\in R^{l\times l}$ 
	and $Q\in R^{k\times k}$ such that 
	\[
		PAQ=
		\begin{pmatrix}
			a_1 & 0 & \cdots & \cdot & \cdot & \cdots & 0\\
			0 & a_2 & \cdots & \cdot & \cdot & \cdots & 0\\
			\vdots && \ddots &  & & & \vdots\\	
			0 & \cdot & \cdots & a_r & \cdot & \cdots & 0\\	
			0 & \cdot & \cdots & \cdot & 0 & \cdots & 0\\	
			\vdots &&&&&\ddots &\vdots\\
			0 & \cdot & \cdots & \cdot & \cdot & \cdots & 0
		\end{pmatrix}
	\]
	where $a_i\ne0$ for all $i\in\{1,\dots,r\}$ and  $a_i\mid a_{i+1}$ for all
	$i\in\{1,\dots,r-1\}$,  then 
	\[
		M\simeq R/(a_1)\oplus\cdots\oplus R/(a_r)\oplus R^{k-r}.
	\]
\end{proposition}

\begin{proof}
	The matrix $PAQ$ is the relations matrix with respect to 
	the generating set $\{m_1,\dots,m_k\}$ of $M$ and respect to the relations submodule 
	given by the rows of $PAQ$.  
    Let 
    \[
    \gamma\colon R^k\xrightarrow{Q^{-1}} R^k\xrightarrow{P^{-1}} R^k\xrightarrow{\varphi} M,
    \]
    where... 
    Since $\varphi$ is surjective, $\gamma$ is surjective. Moreover, 
    \begin{align*}
        \ker\gamma &= (Pe_1Q,\dots,Pe_lQ)\\
        &=((a_1,0,\dots,0),(0,a_2,0,\dots,0),\dots,(0,\dots,a_r,\underbrace{0,\dots,0)}_{\text{$(k-r)$-times}})\\
        &=(a_1)\oplus\cdots\oplus(a_r)\oplus \underbrace{0\oplus\cdots\oplus0}_{\text{$(k-r)$-times}}.
    \end{align*}
    By the isomorphism theorems and Exercise~\ref{xca:submodules},
    \[
    M\simeq R^k/\ker\gamma\simeq R/(a_1)\oplus\cdots\oplus R/(a_r)\oplus R^{k-r}.\qedhere 
    \]
 %    If 
 %    \[ 
 %    \varphi\colon R^k\to M,\quad 
 %    (r_1,\dots,r_k)\mapsto \sum_{i=1}^k r_i\cdot m_i,
 %    \]
 %    then 
	% $R^k/\ker\varphi\simeq M$, as $\varphi$ is a surjective homomorphism. For each 
	% $j\in\{r+1,\dots,k\}$ let $a_j=0$.  Let 
	% \[
	% 	\psi\colon R^k\to R/(a_1)\oplus\cdots\oplus R/(a_k),\quad
	% 	(s_1,\dots,s_k)\mapsto (s_1+(a_1),\dots,s_k+(a_k)). 
	% \]
	% A straightforward calculation shows that 
	% \[
	% 	\ker\psi=(a_1)\oplus\cdots\oplus (a_k).
	% \]
	% Thus 
	% $R^k/\ker\psi\simeq \oplus_{i=1}^k R/(a_i)$. 
		% It is an exercise to show that $\ker\varphi=\ker\psi$. 
	% 	Veamos que $\ker\psi\subseteq\ker\varphi$. 
% 	Si $(s_1\cdot a_1,\dots,s_k\cdot a_k)\in (a_1)\oplus\cdots\oplus (a_k)$, entonces
% 	\[
% 	\varphi(s_1\cdot a_1,\dots,s_k\cdot a_k)=\sum_{i=1}^k s_i\cdot (a_i\cdot m_i)=0,
% 	\]
% 	pues $PAQ$ es la matriz de relaciones de $M$ con respecto a $\{m_1,\dots,m_k\}$. 
% 	Recíprocamente, si $(s_1,\dots,s_k)\in\ker\varphi, entonces
% 	\[
% 	\psi(s_1,\dots,s_k)=(r_1+(a_1),\dots,r_k+(a_k))=(0,\dots,0)
% 	\]
% 	pues $PAQ$ es la matriz de relaciones de $M$ con respecto a $\{m_1,\dots,m_k\}$. 
	% Therefore $M\simeq R/(a_1)\oplus\cdots\oplus R/(a_k)$. To finish the proof
	% we need to note that $R/(a_i)\simeq R$ for all $i\in\{r+1,\dots,k\}$. 
\end{proof}

The decomposition given in the previous proposition is known as 
the \emph{Smith normal form} of the matrix $M$. 
How can we find the matrices $P$ and $Q$? 
Consider the following matrix operations: 
\begin{enumerate}
	\item Switch the $i$-th row and $j$-th row, that is $R_i\leftrightarrow R_j$.
	\item Replace row $R_i$ by $R_i+\lambda R_j$ for some $\lambda\in R$ and $j\ne i$.
	\item Switch the $i$-th column and the $j$-th column, that is $C_i\leftrightarrow C_j$.
	\item Replace column $C_i$ by $C_i+\lambda C_j$ for some $\lambda\in R$ and $j\ne i$. 
	\item Replace row $R_i$ (resp. column $C_i$) by $\lambda R_i$ (resp. $\lambda C_i$) 
	for some $\lambda\in\mathcal{U}(R)$. 
\end{enumerate}
These operations are invertible. For example, the first operation
corresponds to multiply $A$ on the left by a permutation matrix. 
The second
operation corresponds to multiply $A$ by $I+\lambda E_{ij}$ on the left, 
where 
\[
(E_{ij})_{kl}=\begin{cases}
1 & \text{if $i=k$ and $j=l$},\\
0 & \text{otherwise}.	
\end{cases}
\]
Concrete examples:
\[
E_{3,1}=
\begin{pmatrix}
    0 & 0 & 0\\
    0 & 0 & 0\\
    1 & 0 & 0
\end{pmatrix},
\quad
E_{23}=\begin{pmatrix}
    0 & 0 & 0\\
    0 & 0 & 1\\
    0 & 0 & 0
\end{pmatrix},
\]
Similarly, column operations correspond to multiply on the right the matrix $A$
either by a permutation matrix or a matrix of the form $I+\lambda E_{ij}$. 

\begin{theorem}[Smith's normal form]
\index{Smith's normal form}
Let $R$ be an euclidean domain. If $A\in R^{l\times k}$,  
there exists invertible matrices $P\in R^{l\times l}$ and $Q\in R^{k\times k}$ such that 
\[
PAQ=\begin{pmatrix}
a_1 & 0 & \cdots & \cdot & \cdot & \cdots & 0\\
0 & a_2 & \cdots & \cdot & \cdot & \cdots & 0\\
\vdots && \ddots &  & & & \vdots\\	
0 & \cdot & \cdots & a_r & \cdot & \cdots & 0\\	
0 & \cdot & \cdots & \cdot & 0 & \cdots & 0\\	
\vdots &&&&&\ddots &\vdots\\
0 & \cdot & \cdots & \cdot & \cdot & \cdots & 0
\end{pmatrix}
\]
where $a_i\ne0$ for all $i\in\{1,\dots,r\}$ and $a_i\mid a_{i+1}$ for all $i\in\{1,\dots,r-1\}$.
Moreover, the elements $a_1,\dots,a_r$ are unique up to multiplication by
units. 
\end{theorem}

\begin{proof}[Sketch of the proof]
	We only prove the existence. Assume that $(R,\varphi)$ be an euclidean domain.  
	We need to show that $A$ can be turned into a matrix of the form 
\begin{equation*}
B=\begin{pmatrix}
	b_{11} & 0 & \cdots & 0\\
	0 & b_{22} & \cdots & b_{2m}\\
	\vdots & \vdots &&  \vdots\\
	0 & b_{n2} & \cdots & b_{nm}
\end{pmatrix}
\end{equation*}
where each  $b_{ij}$ is divisible by $b_{11}$. Then we apply the same procedure
to the submatrix 
\[
\begin{pmatrix}
	\frac{b_{22}}{b_{11}} & \cdots & \frac{b_{2m}}{b_{11}}\\
	\vdots & &\vdots \\
	\frac{b_{n2}}{b_{11}} & \cdots & \frac{b_{nm}}{b_{11}}
\end{pmatrix}
\]
and repeat the method until we cannot continue. 

Let us show how to get the matrix $B$. 
By applying row and column operations we may assume that the coefficient of $A$ 
with minimal positive Euclidean norm appears in position
$(1,1)$.  
If some $a_{i1}$ is not divisible by $a_{11}$, we use the division algorithm to write   
$a_{i1}=a_{11}u+r$ for some $u\in R$ and $r\in R$ with 
$\varphi(r)<\varphi(a_{11})$. The transformation 
$R_i\leftarrow R_i-uR_1$ turns our matrix into a matrix that 
has $r$ in position $(i,1)$. Similarly, if some $a_{1j}$
is not divisible by $a_{11}$, then $a_{1j}=va_{11}+s$ with $\varphi(s)<\varphi(a_{11})$. 
By applying  
$C_j\leftarrow C_j-vC_1$ our matrix turns into a matrix 
that has $s$ in position 
$(1,j)$.  
If every $a_{i1}$ is divisible by $a_{11}$, say $a_{i1}=a_{11}\lambda_i$, then
apply $R_i\leftarrow \lambda_i R_1-R_i$. Similarly, if 
every $a_{1j}$ is divisible by $a_{11}$, say $a_{1j}=a_{11}\mu_j$, then
apply $C_j\leftarrow C_j-\mu_j C_1$. In this way we replace our matrix by 
a matrix of the form 
\[
\begin{pmatrix}
	a_{11} & 0\\
	0 & A_1
\end{pmatrix}
=\begin{pmatrix}
	a_{11} & 0 & \cdots & 0\\
	0 & * & \cdots & *\\
	\vdots & \vdots & \ddots & \vdots \\
	0 & * & \cdots & *
\end{pmatrix}.
\]
If some entry of the matrix $A_1$ is not divisible by $a_{11}$, apply either 
$R_1\leftarrow R_1+R_i$ or $C_1\leftarrow C_1+C_j$ and repeat 
the procedure described before. 
\end{proof}

We refer to Artin's book \cite[\S14]{MR1129886} for 
a detailed exposition of the Smith normal
when the base ring $R$ is $\Z$ or
$K[X]$ for any field $K$. For an application 
of the Smith's normal to explicit calculations related to 
homology groups, see \cite[\S11]{MR755006}. 
Here we will explain the algorithm with examples. 

% Let 
% \[
% A=\begin{pmatrix}
% K := Integers();
% M := MatrixAlgebra(K, 2);
% A := M ! [[66, 30],[12,4]];
% SmithForm(A);
% \end{pmatrix}\in\Z^{3\times3}.
% \]	

\begin{example}
Let 
\[
A=\begin{pmatrix}
2 & 5 & 3\\
8 & 6 & 4\\
3 & 1 & 0
\end{pmatrix}.
\]

Let us compute the Smith's normal form of $A$.
Since the element with smallest positive norm appears in position $(3,2)$,
we apply the operations $R_1\leftrightarrow R_3$ and 
$C_1\leftrightarrow C_2$ to transform $A$ into 
\[
\begin{pmatrix}
	1 & 3 & 0\\
	6 & 8 & 4\\
	5 & 2 & 3
\end{pmatrix}.
\]
To obtain zeros in positions $(1,2)$, $(1,3)$, $(2,1)$ and $(2,3)$ we 
apply the transformations 
$R_2\leftarrow 6R_1-R_2$, $R_3\leftarrow 5R_1-R_3$ and 
$C_2\leftarrow 3C_1-C_2$. Then our matrix turns into   
\[
\begin{pmatrix}
	1 & 0 & 0\\
	0 & -10 & -4\\
	0 & -13 & -3
\end{pmatrix}.
\]
Multiply the second and the third row 
by $-1$:
\[
\begin{pmatrix}
	1 & 0 & 0\\
	0 & 10 & 4\\
	0 & 13 & 3
\end{pmatrix}.
\]
We perform the same procedure to the submatrix $\begin{pmatrix}10&4\\13&3\end{pmatrix}$. 
We want the smallest element of the submatrix in position 
$(2,2)$. For that purpose, apply $R_1\leftrightarrow R_2$ and 
$C_2\leftrightarrow C_1$:
\[ 
\begin{pmatrix}
3 & 13\\
4 & 10
\end{pmatrix}.
\]
Write $13=3\cdot 4+1$ and apply 
$C_2\leftarrow C_2-4C_1$ to obtain $\begin{pmatrix}3&1\\4&-6\end{pmatrix}$. Interchange 
the first two columns to obtain 
$\begin{pmatrix}1&3\\-6&4\end{pmatrix}$. Apply now 
$R_2\leftarrow 6R_1+R_2$. To the resulting matrix we apply
$C_2\leftarrow 3C_1-C_2$:
\[
\begin{pmatrix}
    1 & 0\\
    0 & 22
\end{pmatrix}.
\]
Hence we find the Smith's normal form of the matrix: 
\[
\begin{pmatrix}
	1 & 0 & 0\\
	0 & 1 & 0\\
	0 & 0 & -22	
\end{pmatrix}.
\]
\end{example}

The previous example can be easily 
solved with Magma:
\begin{lstlisting}
K := Integers();
M := MatrixAlgebra(K, 3);
A := M ! [[2,5,3],[8,6,4],[3,1,0]];
S, P, Q := SmithForm(A);
S;
[ 1  0  0]
[ 0  1  0]
[ 0  0 22]
> S eq P*A*Q;
true
\end{lstlisting}
How to interpret the Smith normal form if the matrix is not a square matrix? 
To understand 
the quotient \[
M=\Z^n/\langle e_1,\dots,e_m\rangle
\]
with $m<n$, each 
of the $n-m$ missing columns
of the Smith's normal form of the matrix gives a factor isomorphic to $\Z$. Thus
\[
M\simeq\Z^{n-m}\times M_1
%\Z/a_1\times\cdots\times a_r,
\]
where $M_1$ is the module obtained from the Smith's normal form. 
% where $a_1,\dots,a_r$ are integers you get from the Smith's normal form, that 
% is $a_i\mid a_{i+1}$ for all $i\in\{1,\dots,r-1\}$.  
If 
$n<m$, then one only needs to ignore the $m-n$ last columns, which will all be 
zero columns. 

\begin{example}
Let $M$ be the abelian group with generators $m_1,m_2,m_3$ and relations 
\[ 
8m_1+4m_2+8m_3=0, 
\quad 
4m_1+8m_2+4m_3=0.
\]
The matrix of relations is then 
\[
A=\begin{pmatrix}
8 & 4 & 8\\
4 & 8 & 4
\end{pmatrix}.
\]	
We claim that $M\simeq\Z/4\times\Z/{12}$. Apply 
$R_1\leftarrow 2R_2-R_1$ to obtain 
\[
\begin{pmatrix}
0 & 12 & 0\\
4 & 8 & 4	
\end{pmatrix}. 
\]
The row operation used corresponds to multiplying on the left by the 
invertible matrix $\begin{pmatrix}-1&2\\0&1\end{pmatrix}$. Thus 
$\begin{pmatrix}
0 & 12 & 0\\
4 & 8 & 4	
\end{pmatrix}$
corresponds to the set of generators 
$\{m_1,m_2,m_3\}$ and relations $12m_2=0$ and $4m_1+8m_2+4m_3=0$.
Apply $C_2\leftarrow C_2-2C_1$ and $C_3\leftarrow C_3-C_1$ to obtain 
the matrix
\[
\begin{pmatrix}
0 & 12 & 0\\
4 & 0 & 0	
\end{pmatrix},
\]
which corresponds to generators $\{m_1+2m_2+m_3,m_2\}$ 
and relations 
\[ 
12m_2=0,\quad 
4(m_1+2m_2+m_3)=0.
\]
The first column operation
corresponds to multiplying on the right by 
the matrix 
\[ 
I-2E_{12}=\begin{pmatrix}1&-2&0\\0&1&0\\0&0&1\end{pmatrix}
\]
and
the second one to right multiplication by the matrix
\[ 
I-E_{13}=\begin{pmatrix}1&0&-1\\0&1&0\\0&0&1\end{pmatrix}.
\]
Finally, interchange the first two rows to obtain
the Smith's normal form of $A$: 
\[
\begin{pmatrix}
4 & 0 & 0\\
0 & 12 & 0	
\end{pmatrix}.
\]
This matrix corresponds to 
the set of generators $\{m_2,m_1+2m_2+m_3\}$ and relations 
\[ 
4(m_1+2m_2+m_3)=0,\quad 
12m_2=0.
\]
The column operation used corresponds to left multiplication by the 
permutation matrix 
$\begin{pmatrix}0&1\\1&0\end{pmatrix}$. 
Thus  $M\simeq\Z/4\times\Z/{12}$. We also obtained that
\begin{align*}
&P=
\begin{pmatrix}
    0&1\\
    1&0
    \end{pmatrix}
\begin{pmatrix}
    -1&2\\
    0&1
    \end{pmatrix}
    =
    \begin{pmatrix}
    0&1\\
    -1&2
    \end{pmatrix}
\shortintertext{and that}
    &Q=\begin{pmatrix}
        1&-2&0\\
        0&1&0\\
        0&0&1
    \end{pmatrix}
    \begin{pmatrix}
        1&0&-1\\
        0&1&0\\
        0&0&1
    \end{pmatrix}
    =\begin{pmatrix}
        1&-2&-1\\
        0&1&0\\
        0&0&1
    \end{pmatrix}.
\end{align*}
\end{example}

Note that the matrices $P$ and $Q$ are not uniquely determined. Here is the Magma code that solves the previous exercise:
\begin{lstlisting}
> A := Matrix(Integers(), 2, 3, [8,4,8,4,8,4]);
> S,P,Q := SmithForm(A);
> S;
[ 4  0  0]
[ 0 12  0]
> ElementaryDivisors(A);
[ 4, 12 ]    
\end{lstlisting}

\begin{example}
Let $M$ be the abelian group generated by $\{m_1,\dots,m_4\}$ and let $K$
be the subgroup of $M$ generated by 
$\{e_1,e_2,e_3\}$, where 
\[
e_1=22m_3,\quad
e_2=-2m_1+2m_2-6m_3-4m_4,\quad
e_3=2m_1+2m_2+6m_3+8m_4.
\]
We want to determine the structure of $M/K$. 
The matrix of relations is  
\[
A=\begin{pmatrix}
	0 & 0 & 22 & 0\\
	-2 & 2 & -6 & -4\\
	2 & 2 & 6 & 8
\end{pmatrix}.
\]
Apply $R_1\leftrightarrow R_3$ and then $R_2\leftarrow R_1+R_2$ to obtain 
\[
\begin{pmatrix}
	2 & 2 & 6 & 8\\
	0 & 4 & 0 & 4\\
	0 & 0 & 22 & 0
\end{pmatrix}.
\]
Apply $C_2\leftarrow C_2-C_1$, $C_3\leftarrow C_3-3C_1$ and
$C_4\leftarrow C_4-4C_1$ to obtain 
\[
\begin{pmatrix}
	2 & 0 & 0 & 0\\
	0 & 4 & 0 & 4\\
	0 & 0 & 22 & 0
\end{pmatrix}.
\]
Apply $C_4\leftarrow C_4-C_2$ to get 
\[
\begin{pmatrix}
	2 & 0 & 0 & 0\\
	0 & 4 & 0 & 0\\
	0 & 0 & 22 & 0
\end{pmatrix}. 
\]
Note that $4\nmid 22$. Apply $R_2\leftarrow R_2+R_3$, $C_3\leftarrow C_3-5C_2$, $C_3\leftarrow C_2$, $R_3\leftarrow R_3-11R_2$ and 
$C_3\leftarrow C_3-C_2$ to get 
\[
\begin{pmatrix}
	2 & 0 & 0 & 0\\
	0 & 2 & 0 & 0\\
	0 & 0 & -44 & 0
\end{pmatrix}.
\]
The group $M/K$ has basis $\{n_1,n_2,n_3,n_4\}$ and relations 
$2n_1=0$, $2n_2=0$ and $44n_3=0$. Thus $M/K\simeq\Z\times (\Z/2)^2\times (\Z/44)$. 
\end{example}

% In the previous example:
% > A := Matrix(Integers(), 3, 4, [0,0,22,0,-2,2,-6,-4,2,2,6,8]);
% > ElementaryDivisors(A);
% [ 2, 2, 44 ]

\begin{example}
	Let $A=\begin{pmatrix}
		1 & -1 & 1\\
		1 & 0 & 2
	\end{pmatrix}$ and $b=\begin{pmatrix} -1 \\ 5\end{pmatrix}$. Let us solve
	the linear system $AX=b$ in the integers. We need to compute
	Smith's normal form of $A$. For example, computer calculations show that
	\[
	P=\begin{pmatrix}
		0 & 1\\
		-1 & 1
	\end{pmatrix},\quad
	Q=\begin{pmatrix}
		1 & -2 & 2\\
		0 & 0 & 1\\
		0 & 1 & -1
	\end{pmatrix},
	\quad
	S=PAQ=\begin{pmatrix}
		1 & 0 & 0\\
		0 & 1 & 0
	\end{pmatrix}.
	\]
	Note that the matrix $S$ is unique, but not the 
	matrices $P$ and $Q$. To solve $AX=b$ we proceed as follows. Let 
	$Y=Q^{-1}X$. Then $AX=b$ implies that 
	\[
		SY=(PAQ)(Q^{-1}X)=Pb=\begin{pmatrix} 5 \\ 1\end{pmatrix}.
	\]	
	Write $X=\begin{pmatrix}
		x\\
		y\\
		z
	\end{pmatrix}$. Since $Q^{-1}=\begin{pmatrix}
		1 & 0 & 2\\
		0 & 1 & 1\\
		0 & 1 & 0
	\end{pmatrix}$, it follows that  
	$Y=Q^{-1}X=\begin{pmatrix}
		x+2z\\
		y+z\\
		y
	\end{pmatrix}$ and hence $SY=\begin{pmatrix}5\\1\end{pmatrix}$ turns into 
	\[
		\begin{pmatrix}
			x+2z\\
			y+z
		\end{pmatrix}
		=
	\begin{pmatrix}
		1 & 0 & 0\\
		0 & 1 & 0
	\end{pmatrix}\begin{pmatrix}
		x+2z\\
		y+z\\
		y
	\end{pmatrix}
	=\begin{pmatrix}
		5\\
		1
	\end{pmatrix}.
	\]
	It follows that the solution of $AX=b$ is then $X=\begin{pmatrix}
		x\\
		y\\
		z
	\end{pmatrix}
	=\begin{pmatrix}
		5-2z\\
		1-z\\
		z
	\end{pmatrix}$ for $z\in\Z$. 
\end{example}

\begin{exercise}
	\label{xca:AX=b}
	Solve $AX=b$ in $\Z$ for $A=\begin{pmatrix}
		0 & 1 & -1\\
		1 & -1 & 0\\
		2 & 0 & -1
	\end{pmatrix}$ and $b=\begin{pmatrix}
		5\\
		1\\
		7
	\end{pmatrix}$. 
\end{exercise}

\begin{exercise}
	\label{xca:factors_260}
	Prove that $\Z^3/\langle
	(6,6,4),(6,12,8)\rangle\simeq\Z\times\Z/2\times\Z/6$.
\end{exercise}

\begin{exercise}
\label{xca:C4}
    Prove that the abelian group with generators 
    $a$, $b$ and $c$ with relations
    \[
    3a+2b+c=0,
    \quad
    8a+4b+2c=0,
    \quad
    7a+6b+2c=0,
    \quad
    9a+6b+c=0,
    \]
    is cyclic of order four.
\end{exercise}

\begin{exercise}
	\label{xca:Smith_Z[i]}
	Compute the Smith normal 
	form of 
	$\begin{pmatrix}
		1+i & 2-i\\
		3 & 5i
	\end{pmatrix}\in M_2(\Z[i])$. 
\end{exercise}

\begin{exercise}
	\label{xca:Smith_Q[X]}
	Compute the Smith normal form of
	\[
		\begin{pmatrix}
			7 & X & 0 & -X \\
			0 & X-3 & 0 & 3\\
			0 & 0 & X-4 & 0 \\
			X-6 & -1 & 0 & X+1 
		\end{pmatrix}\in M_4(\Q[X]).
	\]
\end{exercise}

\begin{exercise}
\label{xca:unimodular}
    Let $G$ be an abelian group of rank $n$ with basis $\{x_1,\dots,x_n\}$. For
    $i\in\{1,\dots,n\}$ let 
    \[
    y_i=\sum_{j=1}^n a_{ij}x_j,
    \]
    where $A=(a_{ij})\in M_n(\Z)$. Then $\{y_1,\dots,y_n\}$ is a basis of $G$ 
    if and only if $A$ is unimodular, that is $\det A\in\{-1,1\}$. 
\end{exercise}

% \begin{exercise}
%     \label{xca:Z3}
%     Find the rank of the submodule of $\Z^3$ generated by 
%     $(1,0,-1)$, $(2,-3,1)$, $(0,3,1)$ and $(3,1,5)$. 
% \end{exercise}